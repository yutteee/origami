<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <title>
      On-Scroll Folding Cardboard Box with Three.js & GSAP | Codrops
    </title>
    <meta
      name="description"
      content="Demo for the tutorial on how to create a 3D cardboard box that folds and unfolds on scroll using Three.js and the GSAP ScrollTrigger."
    />
    <meta
      name="keywords"
      content="cardboard box, on-scroll animation, three.js, unfolding, gsap scrolltrigger"
    />
    <meta name="author" content="Ksenia Kondrashova for Codrops" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="css/base.css" />
    <script>
      document.documentElement.className = "js";
      var supportsCssVars = function () {
        var e,
          t = document.createElement("style");
        return (
          (t.innerHTML = "root: { --tmp-var: bold; }"),
          document.head.appendChild(t),
          (e = !!(
            window.CSS &&
            window.CSS.supports &&
            window.CSS.supports("font-weight", "var(--tmp-var)")
          )),
          t.parentNode.removeChild(t),
          e
        );
      };
      supportsCssVars() ||
        alert(
          "Please view this demo in a modern browser that supports CSS Variables."
        );
    </script>
  </head>
  <body>
    <main>
      <div class="frame">
        <div class="frame__title">
          <h1 class="frame__title-main">
            On-Scroll Folding Cardboard Box with Three.js & GSAP
          </h1>
          <a
            aria-label="Back to the article"
            class="frame__title-back"
            href="https://tympanus.net/codrops/?p=66174"
          >
            <span class="oh__inner">Back to the article</span>
            <svg width="18px" height="18px" viewBox="0 0 24 24">
              <path
                vector-effect="non-scaling-stroke"
                d="M18.25 15.5a.75.75 0 00.75-.75v-9a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h7.19L6.22 16.72a.75.75 0 101.06 1.06L17.5 7.56v7.19c0 .414.336.75.75.75z"
              ></path>
            </svg>
          </a>
        </div>
        <a
          class="frame__prev"
          href="http://tympanus.net/Development/TooltipTransition/"
          >Previous demo</a
        >
      </div>
      <div class="content">
        <div class="page">
          <div class="container">
            <canvas id="box-canvas"></canvas>
            <div class="ui-controls">
              <button
                class="unbutton ui-controls__button"
                id="zoom-in"
                aria-label="Zoom in"
              >
                +
              </button>
              <button
                class="unbutton ui-controls__button"
                id="zoom-out"
                aria-label="Zoom out"
              >
                -
              </button>
              <div>Scroll to animate</div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script
      async
      src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"
    ></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.138.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.138.0/examples/jsm/"
        }
      }
    </script>

    <script src="https://unpkg.co/gsap@3/dist/gsap.min.js"></script>
    <script src="https://unpkg.co/gsap@3/dist/ScrollTrigger.min.js"></script>

    <script type="module">
      import * as THREE from "three";
      import { OrbitControls } from "three/examples/jsm/controls/OrbitControls.js";
      import { FontLoader } from "three/examples/jsm/loaders/FontLoader.js";
      import { TextGeometry } from "three/examples/jsm/geometries/TextGeometry.js";

      gsap.registerPlugin(ScrollTrigger);

      const container = document.querySelector(".container");
      const canvasEl = document.querySelector("#canvas");

      let renderer, scene, camera, orbit, box;
      const axisTitles = [];
      const boxSize = [15, 30, 1];

      let params = { angle: 0 };

      initScene();
      window.addEventListener("resize", updateSceneSize);

      function initScene() {
        renderer = new THREE.WebGLRenderer({
          alpha: true,
          antialias: true,
          canvas: canvasEl,
        });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(
          45,
          container.clientWidth / container.clientHeight,
          10,
          1000
        );
        camera.position.set(0.5, 0, 1.3).multiplyScalar(70);

        updateSceneSize();
        addAxesAndOrbitControls();

        const boxMaterial = new THREE.MeshBasicMaterial({
          color: 0x3c9aa0,
          wireframe: true,
        });
        const boxGeometry = new THREE.BoxGeometry(
          boxSize[0],
          boxSize[1],
          boxSize[2]
        );
        box = new THREE.Mesh(boxGeometry, boxMaterial);
        scene.add(box);

        createScrollAnimation();
        updateSceneOnOrbitControl();
      }

      function addAxesAndOrbitControls() {
        const loader = new FontLoader();
        const textMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
        loader.load(
          "https://unpkg.com/three@0.138.0/examples/fonts/helvetiker_regular.typeface.json",
          (font) => {
            const textParams = {
              font: font,
              size: 1.5,
              height: 0.1,
              curveSegments: 2,
            };
            {
              const textGeometry = new TextGeometry("axis X", textParams);
              axisTitles[0] = new THREE.Mesh(textGeometry, textMaterial);
              axisTitles[0].position.set(30, 1, 0);
            }
            {
              const textGeometry = new TextGeometry("axis Y", textParams);
              axisTitles[1] = new THREE.Mesh(textGeometry, textMaterial);
              axisTitles[1].position.set(1, 30, 0);
            }
            scene.add(axisTitles[0], axisTitles[1]);
            updateSceneOnOrbitControl();
          }
        );

        const lineMaterial = new THREE.LineBasicMaterial({ color: 0x000000 });
        {
          const lineGeometry = new THREE.BufferGeometry().setFromPoints([
            new THREE.Vector3(-1000, 0, 0),
            new THREE.Vector3(1000, 0, 0),
          ]);
          const line = new THREE.Line(lineGeometry, lineMaterial);
          scene.add(line);
        }
        {
          const lineGeometry = new THREE.BufferGeometry().setFromPoints([
            new THREE.Vector3(0, -1000, 0),
            new THREE.Vector3(0, 1000, 0),
          ]);
          const line = new THREE.Line(lineGeometry, lineMaterial);
          scene.add(line);
        }

        orbit = new OrbitControls(camera, canvasEl);
        orbit.enableZoom = false;
        orbit.enableDamping = true;
        orbit.addEventListener("change", updateSceneOnOrbitControl);
      }

      function updateSceneSize() {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.render(scene, camera);
      }

      function updateSceneOnOrbitControl() {
        axisTitles.forEach((t) => {
          t.quaternion.copy(camera.quaternion);
        });
        renderer.render(scene, camera);
      }

      function updateSceneOnScroll() {
        box.rotation.x = params.angle;
        renderer.render(scene, camera);
      }

      function createScrollAnimation() {
        gsap
          .timeline({
            scrollTrigger: {
              trigger: ".page",
              start: "0% 0%",
              end: "100% 100%",
              scrub: true,
              markers: true,
              onUpdate: updateSceneOnScroll,
            },
          })
          .to(params, {
            duration: 1,
            angle: 0.5 * Math.PI,
            ease: "power1.out",
          });
      }
    </script>
  </body>
</html>
